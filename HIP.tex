\chapterwithnum{Study of highly ionizing particles in the strip tracker}

\section{Tracking inefficiencies at beginning of RunII (or clustering, to be decided)}

\subsection{Observed inefficiencies in tracks reconstruction}
 TODO

\subsection{Highly ionizing particles as possible explanation}

In the CMS environment the main mechanism of energy loss of charged particles~(except of electrons) in silicon sensors is ionization. Beyond ionization the traversing particle energy can be deposited in sensor via elastic and inelastic nulear interaction with the siclicon nucleus. These interaction result in nuclear recoil and nuclear fragmentation in case of inelastic interaction. A sufficiently energetic recoiled nucleus can induce displacement of other nuclei in its proximity. All affected nucleai as well as the fragments undergo energy loss by ionization, resulting in very localized large energy depositions in the silicon volume. By simulation of elastic and inelastic interactions in the silicon it was shown that elastic interactions do not lead to high energy depositions, while inelastic interactions can deposit energy up to $\sim$100MeV in tracker sensors, which is $\sim$1000 times larger energy deposit than by ionization only~\cite{Huhtinen:2002yda}. The readout electronics of tracker modules is not designed for such large energy deposits resulting in saturation of electronics and a deadtime in charge collection and thus loss of hits.

\section{Strip tracker readout system}

\subsection{Overview}

-fig overview
    \insertFigure{figures/dataFlow} % Filename = label
                 {0.6}       % Width, in fraction of the whole page width
                 {Overview of the readout chain taken from~\cite{Bainbridge:2004jc}.} % Caption

Particles passing through the modules of silicon strip tracker are loosing their energy mainly via ionization of silicon volume. The movement of the charge carriers toward electords is inducing current on the silicon strips, which is read by the APV25~\cite{French:2001xb} chips glued to the module. The analogue signal from these chips is sent via optical link to the front-end drivers~(FED)~\cite{Baird:2002wg} located at control room. In standard configuration, in FEDs the data are digitalized, processed and reduced. The graphical overview of this data flow is shown in figure~\reffig{fig:figures/dataFlow}

\subsection{Silicon strip modules}
%TODO check the pitch size

The CMS silicon sensors are formed by n-type bulk, which has on one side uniform n+ implant while on the other p+ strips are located. The implants are connected to reverse bias voltage to completly deplete the bulk of the sensor. The thickness of both p+ and n+ implants is small and negligible compared to the bulk, thus almost whole volume of sensor is depleted. Every p+ strip are connected by a wire bond to a read-out electronics. The distance between strips is called a pitch.

%TODO is true 4-6 sensors?, or one sensor with more or less strips?
The tracker modules are consisted by 1-2 sensors, each sensor is having three or four times 128 p+ strips. The larger part of modules have one layer of sensors~(mono modules), the other holds two layers of sensors, which are attached back to back and with a strip inclination of $5.7^{\circ}$ against each other~(stereo modules). Thus the stereo modules are able to give 3-D information in global coordinates about the position where particle hitted the module~(hit position). The modules also differ by the pitch size between each strip which can vary from 80 $\mu$m up to 205 $\mu$m depending on the tracker layer and partition.

The particle crossing silicon sensor is leaving energy predominantly via electromagnetic interaction - by ionization of the silicon volume, the electron-hole pairs are produced along the path of a particle. The energy loss in the material can be described by the Bethe-Bloch formula~\cite{Groom:2000sm} as a function of $\beta\gamma = p/Mc$, where $p$ and $M$ is mometum and mass of the interacting particle. The Bethe-Bloch function has a minimum for $\beta\gamma \approx 3$. Majority of relativistc particles are having this minimal value of $\beta\gamma$ and thus they are called be Minimum Ionizing Particles~(MIP).


Signal starts to be induced on strips once electrons and holes begin to drift towards the electrodes - holes to strips and electrons to back-plane. The charge induced at electrodes can be calculated using Shockley Ramo theorem~\cite{doi:10.1063/1.1710367,Ramo:1939vr}. In framework of this teorem it can be shown~\cite{Bloch:2007zza} that charges drifting toward one strip induce charge on the neighboring strips as well, but the total charge on the neighboring strips will integrate to zero in case that at the end charge carriers are collected at one strip and are not trapped by other strips.

The number of strips reading signal left by a particle depends on charge sharing and electronics crosstalk. Charge sharing is srongly dependent on the particle trajectory position and can be caused by difussion, trajectory inclination or Lorentz angle. While electronics crosstalk is independent of particle trajectory and it is result of the strip coupling via inter-strip capacitance. 

The charge can be induced on more strips also because of inclination of trajectory. Then towards different strips the charge carriers from different parts of trajectory are drifting.

Under normal circumstances the created charge carriers, electrons and holes, would drift on opposite sides directly towards electrods (n+ and p+ implants). But as in the barrels case a perpendicular magnetic field is present, the charge carrier $q$ is deflected from the direction of electric field due to the Lorentz force

\eq{LorentzEquation}
{
    q(E+v \times B).
}

The angle between the electric field lines and drift direction in magnetic field is called Lorentz angle. This angle is independent of track inclination and can be compensated by tilting the modules.

The diffusion, caused by collisions of charge carriers with each other, can also modify the path of the charge carriers from the straight drift following the filed lines. Hovewer this effect is very small and can result only in small amout of charge collected by neighboring strips just in case the particle was passing close the middle of the pitch.


Electronics crosstalk arises from the readout capacitive network -- strips are coupled via capacitance to backplaine and to neighboring strips via inter-strip capacitance. Because of the inter-strip capacitance the collected charge by one channel is shared with the neighboring channels. The coupling of neighboring strips depend strongly on the time~\cite{Bloch:2007zza} thus the coupling constants are different for peak and deconvolution mode, as in deconvolution mode there are 3 sampling times. This effect can be studied numerically via description of the capacitive network by SPICE simulations~\cite{Barberis:1993ph}.


%Chare sharing can be measured from eta function (response function) -eta function R/(L+R), two separate peaks at 0 and 1 if no charge sharing. Shoft because of electronic coupling. Width of the peak determined by the noise. Almost linear charge sharing outside of the peak (plateau) - amount of charge collected by a strip is inversly proportional to the distance of the impact point from that strip (linear charge sharing) - for perpendicular tracks negligible.


\subsection{The APV25 readout chip}

-figure different kinds of signal - pedestal, baseline etc..

    \insertFigure{figures/APVreadout} % Filename = label
                 {0.6}       % Width, in fraction of the whole page width
                 {The schema of the APV25 chip taken from~\cite{Friedl:2001kra}.} % Caption

The charge collected by each channel~(strip) is read by APV25 chip located at the module. The APV is front-end chip providing amplification and shaping of signal from each channel separately. To achive this all APV chips are equipped by preamplifier, CR-RC shaper, analog pipeline and deconvolution filter. The block diagram of APV chip is shown in figure~\reffig{fig:figures/APVreadout} As one APV chip is reading signal from 128 strips, 4-6 chips are present at each module.

The amplified signal is sent to CR-RC shaper to convert strip signal into $\sim$50~ns long voltage pulses. The shaper is providing an output with frequecy of bunch crossings. In case of APV working in the ``peak mode'' the sampled signal at maximum of the pulse shape corresponding to given bunch crossing, is used directly, but usually the APV is operating in ``deconvolution mode'' to reduce the out-of-time pile-up. In the deconvolution mode the weighted sum of the shaper output from three consecutive bunch crossing is used instead.To have a possiblity to optimize the puls shape, the feedback resistors of both preamplifier and shaper as well as  bias current and voltage are fully programable. For the calibration and test of the chip the internal calibration circuit is present. This circuit enables to inject charge to channels prior to the preamplifier stage.

The puls heights and bunch crossing information for all 128 channels are extracted at the end of the analog pipeline upon the request of trigger. The average signal level from 128 channels can be adjusted within the dynamic range of the APV, in order to reduce the signals exceeding the APV range. The processed signal from two APV chips is multiplexed by APVMUX~\cite{Ball:2007zza} into a single line and converted by laser from an electrical to optical signal, which is sent via analog optical fibre to control room. At the control room the optical signal is recevied by the pin diod which is a part of FED.

-TODO write sth about inverter
-TODO picture of APV
%-tickmarck sent every 70 clock cycles when no data are qued for output -  used for synchronization betwwen frontend and backend electronics.

\subsection{The Front End Driver}

The FED is recieving data from 96 optical fibers, each sending information from 2 APVs. The data in form of optical signal are converted to electrical signal, they are reordered and synchronized. For each APV input the signals per channel are extracted and digitized into 10-bit range AD counts~(ADC). In the standard operation mode, the ``Zero Supression~(ZS)'', the pedestal subtraction followed by common mode noise~(CMN or baseline) subtraction is performed. Pedestal is mean strip activity for given strip when no particle is present, which is evaluated from special ``pedestal runs'' taken few times per year. After pedestal subtraction the CMN is the remining noise common to all channels~(electronics, power supplies origin) and calculated on event by event basis as a median over the 128 strips. After both subtractions the channels with values lower than zero are truncated to zero. For all the channels the signal-to-noise ratio~(S/N) is checked separately and if S/N of the channel is smaller than five or S/N of the channel and its neighbor is smaller than two, the ADC of these channels is set to zero~(zero suppressed). Morover the the ADC range id truncated to 8 bits. No change is applied for charges lower than 254 ADC, charges between 254 ADC and 1022 ADC, included are set to 254 ADC and charges aceeding 1022 ADC are stored as 255 ADC. Only information about strips with non-zero ADC values are sent to the CMS data acqusition system~(DAQ). By this procedure the available data are reduced by factor $\sim$60 in order not to overload DAQ system.

For testing purposes the FED is able to operate in others than ZS mode. In case of the ``Virgin Raw~(VR)'' data taking mode no subtractions and suppressions are applied and thus it is suitable mode e.g. for studies of the APV behavior.

In the ideal case when constant current is injected, the output signal should be constant. But is is not the case because of the random fluctuations called elctronics noise. The silicon strips sensors has two sources of electronics noise -- voltage and current sources. These two sources can be induced by either variations of velocity (thermal noise) or by fluctuating number of charge carriers (shot noise)~\cite{website:noise}. Usually the largest noise comes from amplification of signal. 

The noise can be correlated between channels - like in case of CMN, but also due to electronics coupling. Anti-correlation~\cite{Lutz:1987wd} of noise between neighboring channels originating from the inter-strip capacittance was observed. As the total charge must be conserved, in case of upward fluctuation on one strip, the downward fluctuation must occure on neighbor strips leading to anti-correlation of noise between neighboring channels.

\subsection{Offline data treatement}

Offline, the clustering procedure is applied on the ZS channels. The default clustering algorithm is called ``Three threshold algorithm'', posing threshold on seed strip~(strip with the largest signal), neighboring strips and cluster charge in terms of signal-to-noise ratio. Cluster seed must pass requirement S/N>3, adjacent stips can be added in case S/N>2. On top of those requirement the total cluster charge must be five times larger than total cluster noise $\sigma_{total}$ which is defined as

\eq{noiseEquation}
{
    \sigma_{cluster} = \sqrt{\sum_{i} \sigma_{i}^{2}},
}

where $\sigma_{i}$ is noise of channel $i$.

%-gains %https://github.com/cms-sw/cmssw/blob/09c3fce6626f70fd04223e7dacebf0b485f73f54/RecoLocalTracker/SiStripClusterizer/src/ThreeThresholdAlgorithm.cc
During clustering the strip charge is corrected by two calibration -- tickmark gain~(G1) and particle gain~(G2). The tickmark gain is correcting the signal for the transmission losses, mainly for the losses caused by transmission of signal via $\sim$100m long optical fibers. The tickmark is a signal injected to the calibration circuit and from change of its height at readout output the gain per APV can be computed. The other purpose of tickmarks is synchronization of the APVs to central trigger.

The particle gain is coorrecting for differences at the sensor level. This gain is determined from the inoization of silicon sensitive volume per unit of lengt by particle traversing the sensor. The MPV value of the ionization per unit of lenght is then used to equlize the response of different sensors to the MIP charge. 

These calibrations need to be determined frequently as they change because of the aging of the detector orchange of operating conditions~(e.g. temperature).

The final position of hit is obtained charge-weighted positions of channels in cluster, corrected for Lorentz drift in case of TIB and TOB. Additional correction is applied due to the inefficiency of collection of charge deposited close to back-plane.

The reconstructed hits are used for tracks reconstruction~\cite{Chatrchyan:2014fea}, utilizing software reffered as Combinatorial Track Finder~(CTF), based on combinatorial Kalman filter~\cite{Fruhwirth:1987fm}. The CMS tracking is using iterative approach -- first the track the easiest to find are reconstructed (e.g. high $p_{T}$ ones ) and its hits are masked in order to reduce combinatorics for further iterations of tracks finding.


The track reconstruction is performed in 4 steps. First the \textit{track seed} is built from two or three 3-D hits. Then during the \textit{track finding} the track is propagated to neighboring layers of tracker, testing the compatibility of hit with the track by $\chi^{2}$ test. Once the track candidate is complete, the \textit{track fitting} is performed to obtain the best parameters of the track. The last stage is \textit{track quallity selection} when it is tested if the final fit resulted in good $\chi^{2}$, if there are enough layers with hit associated to the track and if the track is originating from the primary vertex.

-tracking cosmics?
-how is it with missing hits? -track is only lost if two consecutive hits are missing? Can differ but usually should be 1 missing hit per track maximum -  in note CMS-TRK-11-001


\section{The impact of highly ionizing particles on APV25 chip}

%energy spectra of heavy fragments produced in silicon are insensitive to energy of incident particle and do not go further than 10MeV, energy loss for such fragments are of order$MeV\mum^{-1}$~thus the fragments can go up to 100 $\mum$ (compare with sensor thickness) - very localized depositions. The light particles from nuclear interactions can travel longer and also contribute significantly to the total energy depositied~\cite{Huhtinen:2000nk}.


\subsection{Studies prior to the LHC data taking}

The effect of Highly Ionizing particles has beed studied in the past during beam tests -- PSI and CERN X5. Large energy depositions impact on electronics was also studied by injection of charge to calibracton circuit of APV or by laser tests~\cite{Adam:2005pz}. In this section I will only describe results of the PSI beam test.

\subsubsection{Experimental setup}

The M1 beamline at PSI provided continuous beam of protons and pions with bunch crossing every 20~ns. For the APV studies the beam was tuned to pion momentum of 300~MeV to best mimic conditions at CMS environment. The tracking system was consicted of 12 layers of tracker modules (3xTIB,3xTEC,6xTOB), but for the study of HIP events only TOB modules were used. These TOB modules had 500~$\mum$ thick sensors with strip pitch of 183~$\mu$m and were equipped by inverter resistors of either 50, 75 or 100 $\Omega$ . Special trigger burst and APV setting was used to trigger HIP event and then provide 29 more events every 25 ns -- resulting in data every 25~ns for 750~ns. All modules were operated in the peak mode. 


-measured probability per pion per sensor plane ins lower than 10-3

%-sensors 320 or 500 mum

\subsubsection{Response of the APV25 chip to the HIP events}

As discussed above the highly ionizing particles deposit large energies up to equivalent of ~1000 MIPs and thus saturate the APV chips. The affected channels collect charge beyond the range of APV which is few tens of MIPs. The remaining channels from 128-channel APV are shifted towards the low part of the APV range and even exceed it. This behavior is result of cross talk effect on the APV chip worsened by the biasing scheme powering inverter and shaper which ensures stable CMN and during normal conditions~\cite{Bainbridge:2004jc}. The CMN distribution can be seen at figure~\ref{fig:figures/CMNandRMSrawPast} in the bottom plot. The CMN distribution is peaking around 0~ADC in the standard consitions. Smaller peak around $\sim$-100~ADC comes from suppressed baselines which are result of HIP events. 

Because of the shift of CMN the HIP events can be easilly recognised by posing requirement on value of the CMN, in case of this study the APV chip which exhibited CMN$\leq$-20 ADC during 750~ns trigger burst was tagged as containinga  HIP candidate. The response of the APV chip on the HIP event is shown in figure~\ref{fig:APVbehaviourpast}. In the plot there are pedestal subtracted data from 6 consecutive TOB modules in 4 different times. In the top-left plot~($T_{event}$ = 300~ns) the first evidence for HIP event -- large signal peak and small shift towards low values of range of the other channels, can be observed in the second module from bottom, second APV. After 50~ns~($T_{event}$ = 350~ns) the channels of APV not collectiong signal are suppresed and thus the peak is fully revealed. The suppresion and large peak can be still observed at $T_{event}$ = 525~ns. At $T_{event}$ = 575~ns the channels start to recover to their initial position. At $T_{event}$ = 525~ns and $T_{event}$ = 300~ns the MIP signal the MIP particle was passing through all six layers of modules. The signal is observed in relative APVs of all layers except of the APV affected by HIP event. The time period, when APV is insensitive to MIP signal is reffered as deadtime.

In the this analysis the selected HIP event satisfies selection CMN$\leq$-20 and HIP cluster seed charge larger than 125~ADC.  In the discussed figure~\ref{fig:APVbehaviourpast} HIP event is associated with event at $T_{event}$ = 350~ns, but as shown at the exaple, the signal from actual HIP interaction occured and was observed already 50~ns before the selected HIP event.

    \insertFigure{figures/CMNandRMSrawPast} % Filename = label
                 {0.6}       % Width, in fraction of the whole page width
                 {TODO\~cite{Bainbridge:2004jc}.} % Caption

-str 120  fig 5.1


%Fully suppressed baselines remain suppressed for around 250ns

\subsubsection{Deadtime induced by HIP events}

The HIP event is supressing all channels from the affected APV which are not collecting signal. Large HIP signals result in full suppression of the channels beyond the lower limit of the APV range. The APV with fully supppressed channels exhibit very small RMS spread~($\sigma_{raw}$) of the data before pedestal subtraction~(raw data), if excluding the channels reading signal. The RMS spread of raw data is shown in top aprt of figure~\ref{fig:figures/CMNandRMSrawPast} where the large peak population are normal operation with value around $\sim$1.6~ADC which is exhibiting spread of pedestals. The smaller peak population with RSM spread <1~ADC are fully supressed baselines not anymore sensitive to the pedestal spread and the tail is populated by data with distorted baselines usually originating from the HIP event. Distorted baselines are result of non-uniform supression and recovery of baseline in response on HIP event.

Based on these observations two event categories were defined. Events with ``fully suppressed'' baselines  satisfy $\sigma_{raw}< 1~ADC$. ``Partially suppressed'' baselines are required to to have $\sigma_{rms}\geq$1~ADC and CMN$\leq$-20~ADC.

-table 5.6 str 149

The deadtime of the APV is evaluated in terms of hit efficinecy $\epsilon_{hit}$ for both APV influence by HIP event $\epsilon_{hit}^{HIP}$ and efficent APVS~(not influenced by HIP event) $\epsilon_{hit}^{good}$. The hit efficiency is defined as $\epsilon_{hit} = N_{hit}/N_{tracks}$, where $N_{hit}$ is number of clusters reconstructed in APV around the track intercetp point, and $N_track$ is number of reconstructed tracks traversing the APV. The deadtime is then time interval during which APV is not fully efficient. The averaged deadtimes for ``fully suppressed'' baselines APVS are shown in table~\ref{table:deadtimesPast} for both inverter resistor values of 50~$\Omega$ and 100~$\Omega$. The ``partially suppressed '' baselines APV exhibit much smaller deadtime compared to the previous case, typically in order of few tens of ns. In the table~\ref{table:deadtimesPast} it can be noticed, that the decreased resistor value isi significantly decreasing deadtime. Although decreasing resistor value has its disadvantage wich is enhancement of baseline distortions, which lead to reconstruction of ``fake'' clusters disscused in more details in \cite{Bainbridge:2004jc} and section~\ref{section:fakeClusters}.


plots
-str 81 fig 3.5

\subsection{Probability of HIP event.}

%chapter 6 Banbridge

REMARKS
-in my case the fraction of HIP is also effected by pile-up
-computation how fake clusters affects tracking
-what is the inverter resistor value first it was 100 but now changes to 50~\cite{Gennai:2003as}
