%Remove the word tuning
%Explain how the simulation is working → how to simulate cluster, describe how it is done
%Present what is the situation
%Description of width not so great
%Not put too much emphasis on the other tests
%Tehn found xtalk is responsible
%Cross talk measurement → 
%Limitations
%Then xtalk from MC + ePerADC

\clearpage

\setcounter{secnumdepth}{4}
\chapterwithnum{Silicon strip tracker simulation}
\setcounter{secnumdepth}{5}


The simulated samples are a vital part of many analyses. For the physics analysis purposes they are used to compare the theoretical signal and background with the measured data. Further, the simulations are also important for the development and understanding of specific analysis methods and in derivation and validation of calibrations. The detector performance indicators such as resolutions and efficiencies rely as well to a large extent on the simulation.

In the section~\ref{sec:CMSsimu} the general simulation work-flow of the CMS is introduced. In the following section~\ref{sec:trackerSimu} a deeper explanation of the simulation of particle charge deposits in the CMS silicon strip tracker is given. In this section the effects of tracker ageing ans simplifications in simulation on the quality of simulated samples are also discussed.

\section{An introduction to the CMS simulation~\label{sec:CMSsimu}}

The CMS simulation work-flow~\cite{Banerjee:2007zz, Hildreth:2017vpw, Hildreth:2015kps} is divided into several steps. At the beginning of the simulation chain the physics events are generated. This step generates particles and their kinematics resulting from the interaction between colliding particles. The final state particles produced by generator are sent by GEANT4 through the ``simulated'' detector in which these particles interact and leave energy deposits. Next step is the simulation of the response of the detector and its electronics to particle traversing the detector. The output of this procedure are RAW data, which can be later reconstructed and slimmed for the purposes of physics analyses. The overview of the simulation steps, which are described in larger detail in the following subsections, can be seen in Fig.~\ref{fig:figures/SimulationFlow}~\cite{website:simuBasics}. The official production of the simulated samples is handled centrally~\cite{Boudoul:2015bkp} by the CMS collaboration.

    \insertFigure{figures/SimulationFlow} % Filename = label
                 {0.99}       % Width, in fraction of the whole page width
                 { A diagram of the simulation work-flow. The four-vectors of generated particles together with the detector description enter to the GEANT4 simulation which output are simulated hits in the detector volume. Optionally the simulated hits from pile-up interactions can be added on top of the simulated hits from physics and the mixture of these hits are digitized during the electronics simulation. In this step the description of the electronics, for example the noise and the detector conditions, for example the temperature, is added. The output of digitization are RAW data~\cite{website:simuBasics}. }


\subsection{Step 1: Monte Carlo event generation}

The Monte Carlo~(MC) generator is a tool designed to produce physics events according to a physics model. In the majority of cases three kinds of generators are used by the CMS collaboration~\cite{website:generation, website:generationIntro}. 

\textbf{General-purpose generators: }
These are for example Pythia~8~\cite{Sjostrand:2014zea} or Herwig++~\cite{Bahr:2008pv}. They provide the description of the result of the proton collision. To generate outgoing particles originating from the interaction of colliding particles, many theoretical models and aspects have to be plugged in the generation process, such as the description of soft and hard interactions in the leading order, parton distribution functions~(PDFs), initial and final state radiations~(ISR and FSR), multiple parton interactions, hadronization of partons and decay of particles.

\textbf{Matrix Element calculators: }
The generators such as Powheg~\cite{Oleari:2010nx} or MadGraph5\_aMCatNLO~\cite{Alwall:2014hca} were developed to provide next-to-leading order~(NLO) calculations. These calculators give the final state description on the parton level which needs to be plugged into one of the general-purpose generators to generate radiations and proceed with the full hadronization.

\textbf{Specific generators: }
These generators are used to generate specific kind of events e.g. diffractive or cosmic events.

\subsection{Step 2: Simulation of the particle interactions in the detector}

To be able to describe data by simulations, the generated particles need to be propagated through the volume of the CMS detector. This is achieved via the GEANT4~\cite{Agostinelli:2002hh, Lefebure:1999wja} toolkit, into which a detailed description of the CMS detector, its active and inactive material dimensions, layout and properties, are plugged. The GEANT4 toolkit propagates the generated particles through the detector, simulates the interactions with material and models the physics processes which happen during the passage of the particles through the detector. This procedure gives as output the simulated hits left by particles interacting with the active volumes of the subdetectors. These simulated hits can originate from primary particles generated by the MC generator, or from the secondary particles which are the result of the GEANT4 simulation process.

The simulation of the pile-up events is done separately from the simulation of the events of interest. The input to the GEANT4 simulation of in-time and out-of-time pile-up is a pool of Minimum Bias single interaction events. To simulate a given luminosity profile a specific distribution of the number of interactions per bunch crossing is chosen. 

%TODO more about OOT - loopers + electronics

The complete simulation performed with GEANT4, also called Full Simulation~(FullSim), is very time intensive and thus it is not suitable to simulate samples for which huge number of events is needed. For this purposes a Fast Simulation~(FastSim)~\cite{Sekmen:2017hzs, CMS:2010spa, Giammanco:2014bza} was developed as an alternative to the FullSim. The FastSim uses a simplified detector geometry and interactions with material, which speeds the simulation by factor of around 100. The comparison of physics objects of FullSim and FastSim shows that FastSim is a reliable alternative that reproduces the FullSim high level objects within around 10\% accuracy~\cite{Sekmen:2017hzs, Abdullin:2011zz}. The FastSim is widely used to produce for example samples of supersymmetric processes, where large scans with different parameter values are needed.

\subsection{Step 3: Simulation of the detector and electronics response to the particle signal}

To obtain the output electronic signal from the detector, the signal hits from GEANT4 are collected by subdetectors. Then the response of the readout electronics to the collected signal is simulated. This step is called the digitization and its input is a merged collection of physics events of interest and pile-up events. There are three domains providing digitization of given subdetectors, which are SimTracker, SimCalorimetry and SimMuon~\cite{website:simdigi}. The digitized samples are in the RAW format and can be further reconstructed in a similar way as data.

\newpage

\section{Simulation of the silicon strip tracker response to the particle signal~\label{sec:trackerSimu}}

In order to use the simulated samples for the analysis purposes and to be able to rely on them, they have to describe the data as well as possible. In case of the tracker, the output of the standard simulation is composed of zero suppressed data, which are further reconstructed into clusters during the reconstruction step. These clusters are used for tracking and physics objects reconstruction, therefore the best possible description of data by simulated samples at cluster level is necessary.

The following Figs.~\ref{fig:figures/clusterchargeRescaledalll0to0simulation} to \ref{fig:figures/seedTOB} show data and simulation comparisons of several important cluster quantities. The ``zero bias'' data sample from year 2017, run 305064 and fill 6298 are compared to a simulated sample of minimum bias events produced in the FullSim configuration. Both data and simulated samples were produced in deconvolution mode. To avoid fake clusters and clusters originating from pile-up, only clusters associated with tracks are used to create the plots in the whole chapter.
 
The charge from a given track collected by an APV is divided by the track length in a sensor, further referred as ``cluster charge'', is shown in Fig.~\ref{fig:figures/clusterchargeRescaledalll0to0simulation}. The data to simulation ratio fluctuates around 1 within around $\pm 0.1$ in the bulk of the cluster charge distribution, but the description worsens for very small and very large cluster charges. Overall the cluster charge distribution in simulation is narrower than in data. 

%[TODO would not be better to use (data-MC)/data instead of data/MC in the ratio plot?]

    \insertFigure{figures/clusterchargeRescaledalll0to0simulation} % Filename = label
                 {0.5}       % Width, in fraction of the whole page width
                 { Data and simulation comparison of on-track cluster charge divided by the track length. The simulated distribution is rescaled to the number of clusters in data. Bottom plot represents data to simulation ratio. }

The cluster width depends on the sensor geometry and therefore has to be shown separately for different geometries. The possible geometries and their location in the tracker can be found in Tab.~\ref{tab:trackerGeometries}. The data to simulation comparisons for inner and outer barrel geometries are shown in Figs.~\ref{fig:figures/widthTIB}~and~\ref{fig:figures/widthTOB}. In all cases there is a very poor description of the cluster width in data by the simulation. The mentioned dependency of the cluster width on the geometry can be seen for example when comparing cluster width between different barrel geometries. The IB1 sensors have a smaller pitch with respect to IB2 ones and therefore the IB1 clusters are in average wider, as in the IB1 case a larger number of strips would collect charge from the same track. The sensors of IB2 and OB1 have a similar pitch, but OB1 sensors are thicker which leads to a larger cluster width in OB1 than in IB2, because the particle path in a sensor is longer. Moreover the cross talk is larger for OB1 than IB2, leading to a larger enhancement in OB1 cluster width compared to IB2.


    \insertTwoFigures{figures/widthTIB} % Filename = label
                 {figures/clusterwidthTIBl1to2simulation}
                 {figures/clusterwidthTIBl3to4simulation} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 { Distribution of the on-track cluster width for IB1 (left) and IB2 (right) geometry in data and simulation. The simulated distribution is rescaled to the number of clusters in data. Bottom plots represent data to simulation ratio for given geometry. }

    \insertTwoFigures{figures/widthTOB} % Filename = label
                 {figures/clusterwidthTOBl1to4simulation}
                 {figures/clusterwidthTOBl5to6simulation} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 { Distribution of the on-track cluster width for OB2 (left) and OB1 (right) geometry in data and simulation. The simulated distribution is rescaled to the number of clusters in data. Bottom plots represent data to simulation ratio for given geometry. }


Another important quantity is the charge on the strip having the largest charge among all strips in cluster rescaled to track path in sensor, which is later referred as ``cluster seed charge''. The cluster seed charge shown in Figs.~\ref{fig:figures/seedTOB}~and~\ref{fig:figures/seedTIB} is also dependent on the module geometry and therefore is shown for four different barrel geometries. In these plots, it can be seen that the simulation in average predicts in all cases a lower cluster seed charge, a clear trend in data to simulation ratio is present. It can also be observed that with a larger pitch, the seed charge increases, as the charge from a larger part of sensitive volume is read by one strip. Moreover differences in the seed charge for IB2 and OB1 are observed. These two parts of the detector have a similar pitch size and difference in the module thickness is taken into account by rescaling the collected charge by the path length. The difference between the two geometries comes from a larger cross talk in OB2, leading to a smaller seed charge.


    \insertTwoFigures{figures/seedTIB} % Filename = label %TDO continue here
                 {figures/clusterseedchargeRescaledTIBl1to2simulation}
                 {figures/clusterseedchargeRescaledTIBl3to4simulation} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 { Distribution of the on-track cluster seed charge for IB1 (left) and IB2 (right) geometry in data and simulation. The simulated distribution is rescaled to the number of clusters in data. Bottom plots represent data to simulation ratio for given geometry. }

    \insertTwoFigures{figures/seedTOB} % Filename = label %TDO continue here
                 {figures/clusterseedchargeRescaledTOBl1to4simulation}
                 {figures/clusterseedchargeRescaledTOBl5to6simulation} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 { Distribution of the on-track cluster seed charge for OB2 (left) and OB1 (right) geometry in data and simulation. The simulated distribution is rescaled to the number of clusters in data. Bottom plots represent data to simulation ratio for given geometry. }


To summarize, the simulation tends in general to overestimate the cluster width and to underestimate the charge on the seed strip. Large variations in the simulation to data ratio are observed. Therefore it is necessary to identify the sources leading to observed data and simulation disagreements and to propose corrections.


\subsection{Signal simulation steps}


To understand how the clusters are simulated and what part of the simulation can lead to an incorrect cluster description, the simulation flow of the silicon strip tracker has first to be described. The generated particles of simulation step~1 are in step~2 sent by GEANT4 toolkit through the simulated detector where they intreact with matter. The format of GEANT4 output is discussed in section~\ref{sec:G4out}. The GEANT4 energy deposits in form of charge carriers are in step~3 propagated through the tracker sensors, collected by the strips, read by the electronics and zero suppressed. The zero suppressed simulated events can then be reconstructed similarly as data.

The third simulation step, also reffered as  ``digitization'' starts with division of energy deposits simulated by GEANT4 along the path of the track passing through given module. The energy deposit are reduced in case that particle arrived before or after the optimal arrival time.  The division of energy deposits and their reduction due to timing is decribed in section~\ref{sec:divide}. In followng section~\ref{sec:drift} the energy deposits are drifted through the sensors towards strips and the effects acting on drift such as diffusion or Lorentz angle are discussed. Then the drifted energy deposits are divided between strips and converted to electrons in section~\ref{sec:induce}. In this section the charge sharing between strips due to capacitive coupling is also described. On top of the charge induced on the strips, the realistic noise is added in section~\ref{sec:digitize}. In the same section the signal is converted to ADCs and rescaled by gains in order to mimic differences in modules of the tracker. The strips which were marked as bad in CMS tracker are masked and the resulting signal is zero suppressed. At the end a possibility of simulating virgin raw data is briefly discussed is nection~\ref{sec:VRsimu}.

In following subsections not only the simulation steps are described in detail, but also the  potential issues in the simulation approach are identified and discussed. For simplicity, in the majority of cases, the cluster seed charge and with distributions are shown only for OB2 geometry. As the standard data-taking mode is the zero suppression mode with APVs operating in the deconvolution mode, the simulation steps are described in these conditions. 

%Other possibilities are shortly discussed as well.

% To achieve good data and simulation agreement, the propagation has to be corrected for effects which happen physically in the sensor, for example the thermal diffusion. Other set of factors is applied on top of the simulated signal to mimic effects of electronics on the signal acquired during the data-taking. The analogue signal with all corrections applied, is digitized. The flow of the simulation steps is shown in Fig.~\ref{fig:figures/trackerSimulationFlow}. 


%    \insertFigure{figures/trackerSimulationFlow} % Filename = label
%                 {0.99}       % Width, in fraction of the whole page width
%                 { A diagram of the of the simulation steps in the CMS tracker. The energy deposited produced by GEANT4 is divided into track segments and drifted towards the strips. Then the charge is induced on the strips. The dead channels are removed and on top of the signal the noise is added. The resulting signal is converted to digis and zero suppressed. }

%TODO naming convention! digitization or simulation?

\subsubsection{GEANT4 output~\label{sec:G4out}}

A simulated hit in the tracker produced by GEANT4 is stored in the CMSTrackerHit~\cite{Lefebure:1364020} object. The CMSTrackerHit is created for each particle entering the tracker and for each sensitive detector unit. In the case of the silicon strip tracker one sensitive detector unit represnets one side of sensors of one module. The CMSTrackerHit object stores the information on the particle entry and exit points in the reference system of the detector unit~$(x_{i}, y_{i}, z_{i})$. The other quantities are energy~($E_{ent}$) of the particle at the point where track enters the detector unit and total amount of energy~($E_{loss}$) deposited in the detector unit by the given particle. The time-of-flight~($TOF$) of particle from the primary interaction point to the detector unit and the identification number of detector unit~($DetID$) and the track~($trackID$) are stored as well. A sketch of a detector unit and the information stored by GEANT4 per detector unit and track is shown in Fig.~\ref{fig:figures/geantDeposit}. In the following, the detector unit will be referred as ``module''.

    \insertFigure{figures/geantDeposit} % Filename = label
                 {0.5}       % Width, in fraction of the whole page width
                 { Sketch of information saved for each simulated hit by GEANT4. The hits are stored per detector unit~($DetID$) and track~($trackID$) and besides $DetID$ and $trackID$ they contain particle entry energy~($E_{ent}$), total energy deposited~($E_{loss}$) by the particle and the time-of-flight~(TOF) of particle from the interaction point to the detector unit. The entry and exit points of the particle in the local frame~($(x_{i},y_{i},z_{i})$) are stroed as well~\cite{website:simuBasics}. }

\subsubsection{Divide energy deposit~\label{sec:divide}}

The GEANT4 provides information about total energy~($E_{loss}$) in form of charge carriers created in the module. But depending on the arrival time of particle to the module, different fraction of this total energy is read. To determine the fraction, time-of-flight~($TOF$) of given particle is compared to the time-of-flight of reference particle traveling at speed-of-light~(photon). The reference particle is assigned to the given bunch crossing and its time of-flight is computed from the speed-of-light and the distance between interaction point and an entry point of the given particle to the given module. The maximum amount of charge is read when the time-of-flight difference between given particle and reference photon is zero. Further the difference from zero, smaller fraction of the particle charge is collected. Because of the bunch crossing assignent the time-of-flight difference between particle and reference can be both negative and positive. Therefore according to the delay between particle and photon at the entry point to the module the time response of the module to the signal left by particle can be determined. The schema of this time response~(pulse shape) to the signal currently used in simulation can be seen in Fig.~\ref{fig:figures/timeResponse}. It can be noticed that the time response of the module to the particle signal can take several tens of ns. It is longer than the time between collisions, which is 25~ns, and therefore in the bunch crossing of interest it is possible to read signal from preceeding and suceeding bunch crossings. This effect is one of the sources of out-of-time pile-up.

    \insertFigure{figures/timeResponse} % Filename = label
                 {0.5}       % Width, in fraction of the whole page width
                 { The deconvolution pulse shape plugged into the simulation. The 0~ns corresponds to the reference~(photon) time, where the maximum of charge is collected.}

The GEANT4 hit stores only a total energy deposition information per one module but in the real data-taking the energy the particle looses its energy continuously as it traverses the module. To mimic this effect, the track is divided into a certain number of equidistant segments. Currently the number of sectors is evaluated as a fixed factor multiplied by the expected number of strips reading the particle signal. The total energy reduced by the time response value as described in previous parahraph is then divided into the track segments and for each segment it is fluctuated according a Landau function. The fluctuated charge per segment is then normalized to keep the sum of the segment energies equal to the initial energy. The local coordinates of the track segment together with the fluctuated normalized energy deposit are saved in an obejct reffered as ``energy deposit unit''.

In the energy division procedure there are several simplifications which can lead to discrepancies between the properties of simulated clusters and clusters in data. GEANT4 provides only the total deposited charge, therefore the charge has to be divided into discreet and equidistant tracks segments, what is still not corresponding to the reality. Moreover it is assumed that the energy loss is constant along the track, but according to Bethe-Bloch formula there is an evolution of the energy loss with the particle momentum. Other issues of this step are discussed in detail the following paragraphs.

\textbf{Cutoff on the delta ray production~$\delta$ }

The charge of each track segment is being fluctuated by the GEANT4 routine. This routine is initialized with a parameter specifying a cutoff~($\delta$) on the delta ray production. The delta rays are already part of previous GEANT4 output and therefore this cutoff has to be the same one as the one in the previous step in order to avoid mismatch. The dependency of the cluster charge, cluster seed charge and cluster width on the delta ray cutoff, which was varied up to $\pm 20\%$ around its default value of 0.120425, is shown in Figs.~\ref{fig:figures/clusterchargeRescaledalll0to0delta}~and~\ref{fig:figures/seedwidthTOBdelta}. From the figures it can be concluded that the change of distributions of the cluster properties is almost negligible in the given range of the cutoff variation. 

    \insertFigure{figures/clusterchargeRescaledalll0to0delta} % Filename = label
                 {0.5}       % Width, in fraction of the whole page width
                 {  On-track cluster charge in simulation for different values of the delta ray production cutoff~$\delta$. The simulated distributions are rescaled to the number of clusters in data. In the ratio plot the default simulation is divided by different simulation scenarios. }

    \insertTwoFigures{figures/seedwidthTOBdelta} % Filename = label %TDO continue here
                 {figures/clusterwidthTOBl1to4delta}
                 {figures/clusterseedchargeRescaledTOBl1to4delta} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 {  On-track cluster width (left) and cluster seed charge (right) in simulation for the OB2 geometry and for different values of the delta ray production cutoff~$\delta$.  The simulated distributions are rescaled to the number of clusters in data. In the ratio plots the default simulation is divided by different simulation scenarios. }

\textbf{Puls shape}

The deconvolution pulse shape used in simulation, presented in Fig.~\ref{fig:figures/timeResponse}, was determined by the parametrization of results obtained in~\cite{Delaere:1061284}. These results were obtained from laser studies of the TOB modules before the start of LHC operation. Fig.~\ref{fig:figures/timeResponseReal} presents the results, when a single strip was hit by the laser. In this plot the resulting pulse shape from the hit strip and the two neighbors on each side is shown. The neighboring strips read non-zero charge purely due to the electronic cross talk, also called ``capacitive coupling'', which is result of the coupling of strips via inter-strip capacitance as shown in Fig.~\ref{fig:figures/capacitanceNetwork}. 

%As mentioned in previous chapter, there are two main sources of cross talk. First is caused by the fact, that when charge carriers are moving inside the sensor, they are inducing charge on more strips, not only the hit one. The amount of the induced charge is time dependent. i


    \insertFigure{figures/timeResponseReal} % Filename = label
                 {0.5}       % Width, in fraction of the whole page width
                 { The deconvolution pulse shape obtained from focusing a laser on one strip of the TOB module. The charge read by the first and second neighboring strips on both sides are shown as well. The largest signal is collected by the hit strip, a lower fraction by its first neighbor and the lowest fraction by second neighboring strip. The lines correspond to the theoretical fits of the data, while the dots are measured data~\cite{Delaere:1061284}.  }
%TODO By default, cross talk in this chapter means capacitive coupling between strips.

It can be noticed that there are several differences between the pulse shape obtained from laser measurements and the one in simulation. First, the times corresponding to the measured maxima of the pulse shapes are not same for the hit strip and for its neighbor. This fact is omitted from the simulation. Secondly, it was measured that the pulse shape can have negative values, while it is not the case in simulation. Thirdly a pulse shape does not take into account the charge trapping in the sensors induced by radiation or any other aging effects of the modules of the CMS tracker. Moreover in 2016 the VFP parameter changed in order to avoid saturation of the electronics, which resulted in a change of the pulse shape in data~\cite{website:vfp}. This change was not propagated into the simulation.

Furthermore there is a dynamics which modifies the pulse shape and which is not modeled in the simulation. For example, the only charge carriers which are present in the simulation are holes drifting to the strips, but the presence of electrons is omitted.

\textbf{Backplane correction}

In 2009, discrepancies in the cluster position between data recorded in peak and deconvolution mode were observed~\cite{website:backplane}.It was found out that the disagreement is worse for the thick sensors and soon the problem was identified as an issue of charge collection from the whole sensor. In the deconvolution mode the charge carriers which are created close to backplane are not read as efficiently as those produced close to strips. As less charge from the material close to the backplane is collected, the cluster position in deconvolution mode is shifted with respect to the peak data, where such problem is not present. To correct the cluster position between peak and the deconvolution data, a correction called ``backplane correction'' is applied on top of deconvolution data during the reconstruction step. As in the deconvolution mode effectively the strip sensor is thinner and therefore the track shorter, this effect does not only have an effect on the cluster position, but also on the cluster charge, the cluster seed charge and the cluster width. Again, this effect is not considered in simulation.

% TODO are not puls shapes difefrent for thick and thin sensors??
%ISSUES
%puls shape problems - puls shape same for all strips (actually reveighted at once), does not have any undershoot, is pretty outdated from here CMS NOTE 2007/027
%charge division itself, eloss does not have to be linear
%delta rays are missing (maybe): delta cutoff in MeV, has to be same as in Geant (0.120425 MeV corresponding to 100um range for electrons)
%puls shape -> must take into account the drift time of holes
% Automatically generated using parametrizePulse::generateCode(low=-30, high=35, step=0.1)
% That pulse shapes correspond to the ones described in CMS NOTE 2007/027
% with tau=50ns and delta=20ns



\subsubsection{Charge drift~\label{sec:drift}}

A particle passing through the module is depositing its energy via ionization of the silicon volume. The created charge carriers then drift to the electrodes. Therefore to describe the reality, in simulation the energy deposits have to be propagated separately from each track segment to the strips. In simulation the energy deposits are not directly converted to the charge carriers, but the energy deposits are dirifted as they would be the charge. As in the barrel regions the electric field is perpendicular to the magnetic field, the drift of the charge carriers is deflected from the direction of electric field, respectively the local z-axis, by the Lorentz angle. Thus the drift direction of the charges towards the surface of the sensor must be corrected accordingly to the Lorentz angle and the local magnetic field. Moreover the charge carriers undergo diffusion in the silicon volume during the drift and therefore the energy deposit from each track segment is collected smeared at the surface due to diffusion effects. To estimate the diffusion, the drift time from the track segment to the sensor surface is computed. This drift time depends on:

\begin{itemize}
\item Sensor thickness: the drift time is longer for thicker sensors
\item Depletion and applied voltage: they influence how fast the charge carriers drift. The depletion voltage is the voltage which fully depletes the sensor while the applied voltage is the total voltage applied, including the depletion voltage.
\item Charge mobility: it is dependent on the material properties, its temperature, the electric field and concentration of the charge carriers. It influences how fast the charge carriers drift, for example the mobility of holes is lower than the one of the electrons
\item Coordinates of the track segment: they are used to determine the distance that the charge  has to drift through
\end{itemize}

The width of the energy distribution is then computed from the knowledge of the drift time and a diffusion constant. The diffusion constant depends on the type of material the charge drifts through and the temperature of the sensor. The output from previous step in form of energy unit after applying the drift and diffusion procedure is stored as object reffered as ``signal point'', with information about its coordinates at the surface, the energy and its spread.

To charge drift depends on several parameters which can be subject of aging. The description of these parameters and effect of their aging on the simulation is presented in following paragraphs.

\textbf{Applied~($AV$) and depletion~($DV$) voltage}

As mentioned, the diffusion depends on the drift time which depends on the applied and depletion voltages. The depletion voltage change during the operation of the tracker, because of the aging of modules, but this information was not updated in the simulation. The applied voltage was not changed during the operation of CMS, but it will become necessary, once the depletion voltage will be larger than applied one. To evaluate the effect of the voltage change on the cluster charge, seed charge and width, these distributions are shown for several different values of depletion and applied voltage in Figs.~\ref{fig:figures/clusterchargeRescaledalll0to0AV}~to~\ref{fig:figures/seedwidthTOBDV}. in the depletion with default value of 170~V and applied voltage with default value of 300~V are present in these figures from which can be concluded, that within a$\pm 20\%$ variation the depletion voltage around its default value of 170~V and applied voltage around its default value of 300~V, the change of cluster properties is negligible.

%\ref{fig:figures/seedwidthTOBAV}~\ref{fig:figures/clusterchargeRescaledalll0to0DV}

    \insertFigure{figures/clusterchargeRescaledalll0to0AV} % Filename = label
                 {0.5}       % Width, in fraction of the whole page width
                 { On-track cluster charge in simulation for different values of the applied voltage~$AV$.  The simulated distributions are rescaled to the number of clusters in data. In the ratio plot the default simulation is divided by different simulation scenarios. }

    \insertTwoFigures{figures/seedwidthTOBAV} % Filename = label %TDO continue here
                 {figures/clusterwidthTOBl1to4AV}
                 {figures/clusterseedchargeRescaledTOBl1to4AV} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 {  On-track cluster width (left) and cluster seed charge (right) in simulation  for the OB2 geometry and for different values of the applied voltage~$AV$.  The simulated distributions are rescaled to the number of clusters in data. In the ratio plots the default simulation is divided by different simulation scenarios. }


    \insertFigure{figures/clusterchargeRescaledalll0to0DV} % Filename = label
                 {0.5}       % Width, in fraction of the whole page width
                 {  On-track cluster charge in simulation for different values of the depletion voltage~$DV$.  The simulated distributions are rescaled to the number of clusters in data. In the ratio plot the default simulation is divided by different simulation scenarios. }

    \insertTwoFigures{figures/seedwidthTOBDV} % Filename = label %TDO continue here
                 {figures/clusterwidthTOBl1to4DV}
                 {figures/clusterseedchargeRescaledTOBl1to4DV} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 {  On-track cluster width (left) and cluster seed charge (right) in simulation  for the OB2 geometry and for different values of the depletion voltage~$DV$.  The simulated distributions are rescaled to the number of clusters in data. In the ratio plots the default simulation is divided by different simulation scenarios. }

\textbf{Temperature~($T$) and charge mobility~($\mu$)}

The diffusion constant $D$ can be expressed as

\eq{driftEquation}
{
   D=  \frac{\mu k_{B} T}{q},
}

where $\mu$ is the charge mobility, $k_{B}$ the Boltzmann constant, $T$ the absolute temperature of material and $q$ the electrical charge of particle. Between Run~I and Run~II the temperature of the tracker was changed from 4$^{\circ}$C to -15$^{\circ}$C and between 2017 and 2018 from -15$^{\circ}$C to -20$^{\circ}$C, but here too this change was not propagated into simulation, therefore it is important to evaluate its effect. The cluster charge, width and seed charge are shown in Figs.~\ref{fig:figures/clusterchargeRescaledalll0to0T}~and~\ref{fig:figures/seedwidthTOBT}. The plots of default simulation with $T=273$~K together with variations up to $\pm 20\%$ of the temperature in the simulation are showing that the dependency of cluster charge, width and seed charge on temperature is negligible. 

The charge mobility intrinsically also depends on the temperature, and also on the concentration of defects which change in time and therefore should be in principle also adjusted in the simulation. Figs.~\ref{fig:figures/clusterchargeRescaledalll0to0mu}~and~\ref{fig:figures/seedwidthTOBmu} are revealing a change of cluster charge, width and seed charge when altering the default charge mobility of $310 \mathrm{cm^2/(V \cdot s)}$ by up to $\pm 20\%$. This change is again negligible. In summary there is almost no change in simulated cluster properties due to diffusion because the magnitude of diffusion is much smaller than the pitch size.


    \insertFigure{figures/clusterchargeRescaledalll0to0T} % Filename = label
                 {0.5}       % Width, in fraction of the whole page width
                 { On-track cluster charge in simulation for different values of the temperature~$T$.  The simulated distributions are rescaled to the number of clusters in data. In the ratio plot the default simulation is divided by different simulation scenarios. }

    \insertTwoFigures{figures/seedwidthTOBT} % Filename = label %TDO continue here
                 {figures/clusterwidthTOBl1to4T}
                 {figures/clusterseedchargeRescaledTOBl1to4T} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 {  On-track cluster width (left) and cluster seed charge (right) in simulation  for the OB2 geometry and for different values of the temperature~$T$.  The simulated distributions are rescaled to the number of clusters in data. In the ratio plots the default simulation is divided by different simulation scenarios. }

    \insertFigure{figures/clusterchargeRescaledalll0to0mu} % Filename = label
                 {0.5}       % Width, in fraction of the whole page width
                 { (top) On-track cluster charge in simulation for different values of the charge mobility~$\mu$.  The simulated distributions are rescaled to the number of clusters in data. In the ratio plot the default simulation is divided by different simulation scenarios. }

    \insertTwoFigures{figures/seedwidthTOBmu} % Filename = label %TDO continue here
                 {figures/clusterwidthTOBl1to4mu}
                 {figures/clusterseedchargeRescaledTOBl1to4mu} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 { On-track cluster width (left) and cluster seed charge (right) in simulation  for the OB2 geometry and for different values of the charge mobility~$\mu$.  The simulated distributions are rescaled to the number of clusters in data. In the ratio plots the default simulation is divided by different simulation scenarios. }

%then we have the lorentz angle
\textbf{Lorentz angle~($LA$)}

The Lorentz angle used in simulation is dependent on the electric field and therefore the Lorentz angle should be updated with the change of voltage. The effect of the Lorentz angle on the simulated cluster charge, width and seed charge is shown in Fig.~\ref{fig:figures/clusterchargeRescaledalll0to0LA}~and~\ref{fig:figures/seedwidthTOBLA}. The Lorentz angle injected into the simulation is specific for each module and it is read from the condition database. The distribution of Lorentz angles in the OB2 geometry per cluster was fitted by  a Gaussian distribution to obtain its mean value and standard deviation. Then the mean was altered by up to twice the standard deviation and injected into the simulation to obtain the varied simulated samples. It can be concluded that within the range of injected Lorentz angle values there is a small but visible effect on the description of the shown cluster properties. Except of the cluster width, charge and seed charge the Lorentz angle changes the position of the cluster. Therefore within a tracker local reconstruction group there are intents to remeasure and update Lorentz angle values.


    \insertFigure{figures/clusterchargeRescaledalll0to0LA} % Filename = label
                 {0.5}       % Width, in fraction of the whole page width
                 { On-track cluster charge in simulation for different values of the Lorentz angle~$LA$.  The simulated distributions are rescaled to the number of clusters in data. In the ratio plot the default simulation is divided by different simulation scenarios. }

    \insertTwoFigures{figures/seedwidthTOBLA} % Filename = label %TDO continue here
                 {figures/clusterwidthTOBl1to4LA}
                 {figures/clusterseedchargeRescaledTOBl1to4LA} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 { On-track cluster width (left) and cluster seed charge (right) in simulation for the OB2 geometry and for different values of the Lorentz angle~$LA$.  The simulated distributions are rescaled to the number of clusters in data. In the ratio plots the default simulation is divided by different simulation scenarios. }

Overall the description of the drift is simplified in the simulation in order to kepp the processing time relatively short. It does not take into account any radiation damages of the silicon, aging of modules, or non-uniformities of the electric filed.

%ISSUES
%charge is induced also by electrons
% charge is beiing induced - no cross talk due to induction.
%point-like track segment - spread i  charge should be already there...
%temperature changes with time
%lorentz angle changes as well because of different voltage
%ultimately the voltage itself play a large role
%charge mobility

\subsubsection{Induce charge on the strips~\label{sec:induce}}

Once the energy deposits are drifted the surface, the amount of electrons induced on the given strips is simulated. The energy cannot be divided between strips purely based on the geometrical criteria, due to the capacitive coupling between the strips. The capacitive coupling causes that the charge collected by one strip is partially shared with its first and second neighboring strips on both sides. This is true for the deconvolution mode, while sharing only between the first neighboring strip on each side is observed in the peak mode.   

The signal point at the surface is associated to the closest strip. Here the energy is converted to the number of electrons (charge). The charge is then divided between the neighboring strips according the energy spread originating from the diffusion. This is repeated for all signal points. If one strip obtains signal from more signal points, these charge deposits are summed. On top of the assigned charge to strips, the cross talk effect is applied. The simulation iterates over all strips from left to right, and shares the charge of a given strip in between its neighbors.

Several parameters have to be plugged into simulatio to induce charge onthe  strips. All these parameters can evolve with ageing of the modules and therefore the impact of their change on the cluster propertioes is discussed in following paragraphs. 

\textbf{Cross talk~($XT$)}

In reality, the charge is induced on the strips already once the electrons and holes start to drift to the backplane and strips and at that time both kinds of cross talks start to play their roles. The simulation is simplifying the description, by decomposing these steps, first only holes are drifted towards the strips, second the charge on the strips is collected and then the cross talk caused by the capacitive coupling is applied. The cross talk could change in time due to radiation damages of modules. The change in cross talk would have a small impact on the cluster charge, but the cluster width and cluster seed charge would change largely as the sharing between strips is impacted. In Figs.~\ref{fig:figures/clusterchargeRescaledalll0to0}~to~\ref{fig:figures/seedTOB}, it was observed that the simulation describes well the cluster charge in data, but there is large disagreement between data and simulation for the cluster width and seed charge, therefore a change of cross talk would be a good candidate to explain the observed discrepancies.  To evaluate, what would be an impact of a non-correct description of the cross talk, the Figs.~\ref{fig:figures/clusterchargeRescaledTOBl1to4XT}~and~\ref{fig:figures/seedwidthTOBXT} show cluster charge, width and seed charge distributions for several different cross talk configurations. In these plots it can be indeed seen that the cluster width and seed charge, which are poorly described in simulation, are strongly dependent on the cross talk. The cluster charge dependence on  the cross talk is much weaker. To evaluate if there is a cross talk parametrization which could be injected into simulation to describe the measured data, the matrix of simulated samples was produced. In these samples both charge sharing between fist and second neighboring strips was varied. The cluster width distribution of each simulated sample was compared to data, based on a $\chi^{2}$ test. The sample with the best $\chi^{2}$ is shown in green in Figs.~\ref{fig:figures/clusterchargeRescaledTOBl1to4XT}~and~\ref{fig:figures/seedwidthTOBXT}. In the figures it can be noticed, that a decrease of charge sharing between both first and second neighboring strip compared to the default simulation is required in order to better describe data. After this procedure the data and simulation agreement in cluster width and seed charge is vastly improved, but it is still not perfect as the parameters and conditions which cause minor source of discrepancies have to be updated as well. The remaining discrepancies could be then caused by a simplification of the cluster simulation. More details about the cross talk and its evaluation are given in section~\ref{sec:xtalk}.


    \insertFigure{figures/clusterchargeRescaledTOBl1to4XT} % Filename = label
                 {0.5}       % Width, in fraction of the whole page width
                 { Data and simulation comparison of on-track cluster charge divided by the track lengthn for OB2 geometry and for different values of the cross talk~$XT$.  The simulated distributions are rescaled to the number of clusters in data.  Bottom plot represents data to simulation ratios. }

    \insertTwoFigures{figures/seedwidthTOBXT} % Filename = label %TDO continue here
                 {figures/clusterwidthTOBl1to4XT}
                 {figures/clusterseedchargeRescaledTOBl1to4XT} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 { Distribution of the on-track cluster width (left) and cluster seed charge (right) in data and simulation for OB2 geometry and for different values of the cross talk $XT$.  The simulated distributions are rescaled to the number of clusters in data.  Bottom plots represent data to simulation ratios. }

\textbf{Energy to electron conversion factor~($Ee$)}

With the ageing of the modules, the conversion between the energy and the number of electrons can evolve. The data and simulations comparisons of the cluster charge, width and seed charge are shown in Figs.~\ref{fig:figures/clusterchargeRescaledalll0to0Ee}~and~\ref{fig:figures/seedwidthTOBEe}. Again, a set of simulations produced by changing the conversion factor up to $\pm 20\%$ from its default value is plotted as well. In these figures it can be noticed that the change of conversion factor between deposited energy and the electron multiplicity in the given range leads to significant changes in all cluster quantities. But from the plots it can be concluded that only a change of this conversion factor would not be able to provide good data and simulation agreement in all these three quantities.

    \insertFigure{figures/clusterchargeRescaledalll0to0Ee} % Filename = label
                 {0.5}       % Width, in fraction of the whole page width
                 { Data and simulation comparison of on-track cluster charge divided by the track lengthn for OB2 geometry and for different values of the conversion factor between deposited energy and electrons~($Ee$). The simulated distributions are rescaled to the number of clusters in data.  Bottom plot represents data to simulation ratios. }

    \insertTwoFigures{figures/seedwidthTOBEe} % Filename = label %TDO continue here
                 {figures/clusterwidthTOBl1to4Ee}
                 {figures/clusterseedchargeRescaledTOBl1to4Ee} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 { Distribution of the on-track cluster width (left) and cluster seed charge (right) in data and simulation for OB2 geometry and for different values of the conversion factor between deposited energy and electrons~($Ee$).  The simulated distributions are rescaled to the number of clusters in data.  Bottom plots represent data to simulation ratios. }

%TODO more about xtalk
%in reallity not like this at all, the carriers drift and induce charge
%association to the closest strip - well if the center is close to middle, this is dangerous
%cross talk not correct on the edges, first and last strips
%no dynamics, sequential cross talk
%maximal cluster charge and seed charge at different time because of the puls shapes
%the emasurements of cross talk  are done in a way that not only capacitive coupling is inside

\subsubsection{Conversion of the analog signal to digital~\label{sec:digitize}}

Before the digitization of the signal, few more effects must be considered. First, in the detector, several strips are dead. The information about dead channels is stored in the condition database, read by the simulation, and if the dead channel has non-zero value of simulated charge, it is set to zero. Secondly, to mimic real conditions, the realistic noise has to be added to each strip. The noise per each strip is determined from the the fluctuation of the strip charge after pedestal and CMN subtraction in data runs when no collision was present. The noise is stored in the condition database, and for needs of simulation read from there. The noise is stored in ADC, therefore it has to be converted to the number of electrons by a dedicated conversion factor. Moreover because of differences between modules in detector, the noise has to be rescaled by gains of the given modules to correct for module differences. The gain~(Gsim) used in simulation is determined from G1 gain measured in data, which is described in Sec.~\ref{sec:localreco}. The current choice of  Gsim computation takes the G1 value from data and smears it by a random smearing to take into account the fluctuation of G1 over time.

 The sum of signal and noise on the strips in electron units is then converted to ADCs by the conversion factor and scaled by Gsim to mimic the output from the detector. During the reconstruction step, both data and simulation are corrected by 1/(G1$\times$G2) to eliminate module differences. Therefore it would be possible not to apply any gain on the simulated data as in the simulation itself no differences between similar modules are introduced. And indeed, for the first simulations, no gains were applied, but later it was decided to apply gains to be able to simulate saturation effects. In FED, the charge in ADC is truncated into 8-bit range, therefore the Gsim is applied to mimic the realistic output of detector. Then, the simulated data in ADC are zero suppressed and stored as digis.

The gains, noise as well as the conversion factor between electron and ADCs change during the operation of the CMS because of the change of operating conditions and radiation damage of the modules. The evolution of these quantities is discussed in following paragraphs.   
 
\textbf{Gains and noise}

The gains and noise are strongly dependent on the tracker operating temperature and radiation damage, and therefore they are measured several times per year and updated regularly for needs of the data reconstruction. These values are not propagated to the simulation, using conditions from a different condition database, which are updated with a much smaller frequency. The difference of noise and gain between data and simulation can lead to a different zero suppression and also different reconstruction results. If the noise is larger in one case than the other, it can appear that a strip with a given charge can fail the S/N threshold criterion in one case and pass in other. This effect can lead to discrepancies in the cluster width and charge between data and simulation. To evaluate the current status, the cluster seed noise rescaled by Gsim, further called only as ``seed noise'', is shown in Fig.~\ref{fig:figures/clusterseednoiseTOBl1to4simulation}. From these plots it is obvious that the difference in the seed noise between data and simulation is huge. This finding triggered the update of these conditions by the responsibles of the tracker local reconstruction group. The gains in simulation will be updated during 2018.


    \insertFigure{figures/clusterseednoiseTOBl1to4simulation} % Filename = label
                 {0.5}       % Width, in fraction of the whole page width
                 { Data and simulation comparison of on-track cluster seed noise for OB2 geometry. The simulated distribution is rescaled to the number of clusters in data.  Bottom plot represents data to simulation ratio. }


\textbf{Electrons to ADC conversion factor~($eADC$)}

Similarly, as for the conversion factor between energy and electrons, the conversion factor between electrons and ADC is sensitive to the aging of modules. The comparisons of data and different simulations with conversion factor between elecrons and ADCs changed within up to $\pm 20\%$ from the default value of 247~$\mathrm{ADC^{-1}}$ for the cluster charge, width and seed charge are shown in Figs.~\ref{fig:figures/clusterchargeRescaledalll0to0eADC}~and~\ref{fig:figures/seedwidthTOBeADC}. By its nature the impact on the cluster quantities is very similar as for the conversion factor between energy and electrons, but again the conversion factor alone is not responsible for the non-description of the data by simulation.  


    \insertFigure{figures/clusterchargeRescaledalll0to0eADC} % Filename = label
                 {0.5}       % Width, in fraction of the whole page width
                 { Data and simulation comparison of on-track cluster charge divided by the track length for OB2 geometry and for different values of the conversion factor between number of electrons and ADCs~($eADC$). The simulated distributions are rescaled to the number of clusters in data.  Bottom plot represents data to simulation ratios. }

    \insertTwoFigures{figures/seedwidthTOBeADC} % Filename = label %TDO continue here
                 {figures/clusterwidthTOBl1to4eADC}
                 {figures/clusterseedchargeRescaledTOBl1to4eADC} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 { Distribution of the on-track cluster width (left) and cluster seed charge (right) in data and simulation for OB2 geometry and for different values of the conversion factor between number of electrons and ADCs~($eADC$).  The simulated distributions are rescaled to the number of clusters in data.  Bottom plots represent data to simulation ratios. }

%TODO plot seed noise
%TODO plot e per ADC
%TODO G1, G2, Gsim
%TODO all the hits are accumulated for each evet!
%TODO write something about database
 
\subsubsection{Virgin raw simulation~\label{sec:VRsimu}}

Besides the standard zero suppressed simulation, the tracker digitization step brings a possibility to simulate virgin raw data. To simulate VR data, several steps need to be added to the simulation steps described above. After inducingi the charge on strips, the APV saturation due to HIP effect can be simulated. This option is by default switched off. Then the APV baseline is shifted down from its designed position of 127~ADC accordingly to the amount of charge collected by a given APV and the number of channels reading the charge. Then the realistic strip noises, CMNs and pedestals are added and the results is stored.

%TODO the baseline shift is not correct according to me 
%TODO - there is a diffusion of the charge in the perpendicular(ask?) plane
% TODO	-particle goes straight (ask? meaning the track goes straight?)
% TODO charge spread depends on applied and depletion voltage ???

\newpage

\section{Improvement of the simulation}

As identified in the above sections the change of cross talk parameters could lead to a better description of data by simulation. There are two possibilities how to update cross talk parameters. The first possibility was already introduced in subsection~\ref{sec:induce} and it is to produce a matrix of samples, each changing the two free cross talk parameters by step. Then it can be estimated via a $\chi^{2}$ test, which simulated cluster width distribution fits the one in data. Before such tuning of the cross talk, it is necessary to perform an update of the bad channels, noise and gains in the simulation. The noise and gains are measured conditions, which are influencing the cluster properties and therefore it is indispensable to update them prior to the cross talk tuning.

The second option is to measure the cross talk parameters from data. In following subsection~\ref{sec:xtalk}, the results on the cross talk measurement are presented and then compared with the results obtained by the tuning of cross talk from data and simulations comparisons.

%The first step how to imporve the description of data is update of the conditions
%-first nose gains and bad channels need to be updated
%-then plug in cross talk
%- then if neeeded tune one fo the conversion factors
%-In the previous sections several limitiations and simplifications in simulation process vere identified. In further steps the simulation could be improved to mimic more realistically hoe the clusters are created inCMS detector.


\subsection{Cross talk  measurement~\label{sec:xtalk}}

The cross talk used in simulation was obtained by a measurement on CRUZET VR data at the beginning of Run~I. After identifying that the outdated cross talk could lead to large discrepancies between data and simulation, the decision  to remeasure the cross talk was taken. The new data for the cross talk measurement were taken in the virgin raw mode at the end of March 2018. These data are CRUZET, implying that there was no magnetic field and no collisions in the detector during the data taking therefore only cosmic muons were triggered. The trigger used during this data-taking, was first designed for triggering cosmics during collisions~(CDC), which was requested by the tracker alignment group. It advantage is that it increases the probability of triggering muons which passed through the tracker. The CDC trigger bit~\cite{website:trigger} assumes that muon passes through the whole CMS in around 30~ns, implying that the top leg of the muon should be seen in top part of detector at bunch crossing equal to minus one, and the bottom leg in the bottom part of detector at bunch crossing equal to zero. Moreover the two legs should be back to back, leading to the requirement on angle between the legs to be $\pi \pm 1/6\pi$. To further enhance cosmics passing through the tracker, the criteria on phi and eta are imposed. The top leg must pass the requirement $|\phi|<1/2\pi \pm 1/3\pi$ and the bottom leg $|\phi|<3/2\pi \pm 1/3\pi$, the eta of muon is required to satisfy $|\eta|<1.202$. The requirement on $\eta$ results in muons which are almost exclusively measured by DTs only. In totality 145854 of CRUZET VR events in runs 312627, 312972, 312973, 312974 and 312977 were taken and saved.

The data with zero magnetic field are important to decompose effects of Lorentz angle from the cross talk. Furthermore the data need to be in the VR mode in order not to suppress the strips which have non-zero charge because of the cross talk, but which is small enough to be zero suppressed. At first, the strategy of the previous cross talk measurement was reused. When there is no cross talk effect, the total charge $Q$ should be collected only by one strip in case that the track passes only through the sensitive volume of the sensor belonging to one strip. But as shown in Fig.~\ref{fig:figures/crossTalk}, due to the cross talk effect, the charge is shared with two neighboring strips on each side and the charge collected by this seed strip is not $Q$ but only a fraction $x_{0}$ of the original charge $Q$.The neighboring strips obtain smaller fractions $x_{1}$ and $x_{2}$ of this charge $Q$. The total charge has to be conserved, leading in requirement on the fractions to be $1=x_{0}+2x_{1}+2x_{2}$. To study such charge sharing, the selection on the angle of the track imposed, in order to reduce probability that the track traverses the sensor area belonging to more strips. The selection on the track was chosen to be the same as in previous measurement:

\eq{narrowTrack}
{
|\mathrm{tan}\theta \mathrm{cos}\phi| < 0.5 \times (p/t),
}

where $\theta$ and $\phi$ are local track angles defined in Fig.~\ref{fig:figures/localCoordinates}, $p$ is the pitch between strips and $t$ is the sensor thickness. This seclection is ensuring, that the track is close to be perpendicular to the sensor plane. The track passing such criterion is shown in Fig.~\ref{fig:figures/moduleCT} and is denoted as ``accept''. On contrary tracks like the one denoted as ``reject'' are rejected by this criterion. Furthermore quality criteria on number of hits in the track larger than six and $\chi^{2}/dof$ of the track are imposed to select only good tracks. The cross talk can be then measured from the strip charges within clusters originating from the accepted tracks. For the purpose of the cross talk measurement, each cluster is reconstructed from pedestal and CMN subtracted digis with no truncation of strips with negative charge, as five strips wide cluster with a seed in the middle. Then the fraction of shared charge can be computed as


\eq{fractions}
{
x_{i} = \frac{\eta_{\pm i}}{1+2\eta_{\pm 1}+2{\eta_{\pm 2}}} ,
}

with $\eta_{i}$ defined as

\eq{etas}
{
\eta_{\pm i} = \frac{q_{\pm i}}{q_{0}} = \frac{x_{i}}{1-2x_{1}-2{x_{2}}} ,
}

where i=1,2, $x_{1}$ is fraction of the charge recieved by the first neighboring strip,  $x_{2}$ is fraction of charge recieved by the second neighboring strip and $x_{0}$ is obtained from the normalization condition. $q_{0}$ is the charge read by the seed strip and $q_{i}$ the charge registered by the neighboring strips. The distributions of $q_{\pm 1}/q_{0}$ and $q_{\pm 2}/q_{0}$ are each filled twice per clusters and fitted separately by Gaussian function, avoiding the tails. The mean values of these distributions are inserted in the Eq.\ref{eq:fractions} in order to compute the fraction of charge shared to neighboring strips. The results on cross talk measurement from Run~I which are currently used in simulation together with the results of presented measurement described later, can be seen in Tab.~\ref{tab:measuredXtalk}. During the Run~I measurement, it was found out that the cross talk differs for each module geometry and thus it has to be measured separately for each geometry. In the table, only the cross talk measurement results from the barrels are present, as due to the eta cut of chosen trigger for the current data-taking, the tracks passing the disks and endcaps are suppressed. 

    \insertFigure{figures/crossTalk} % Filename = label
                 {0.5}       % Width, in fraction of the whole page width
                 { A schema of charge sharing between neighboring strips. }

    \insertFigure{figures/moduleCT} % Filename = label
                 {0.5}       % Width, in fraction of the whole page width
                 { A schematic view of the track selection for the cross talk measurement. }


As discussed, the observed pulse shapes for the seed strip and the neighboring strips are different and they peak at different time, leading to the conclusion that the cross talk evolves as a function of time. To test such hypothesis the time information about muon is required. The time of muon is given at the interaction point and details about its computation can be found in section~\ref{sec:muonTiming}. In the data acquired in 2018 two kinds of muons were observed. Ones having hits only in top part of DTs as sketched in the left part of Fig.~\ref{fig:figures/muonTracks}, further referred as ``top muons'',  and others having hits only in bottom part of DTs as shown in right part of Fig.~\ref{fig:figures/muonTracks}, in later referred as ``bottom muons''. In around 90\% of cases both top and bottom muon is present in one event, as they are two legs of the same muon, but both are associated with different time. 

The goal of this analysis is to find muons which passed the IP at the same time as a muon in collision would be produced. Having the time information it is possible to study the evolution of cross talk for muons which passed the interaction point during, before or after the collision time. The collision muon would be produced at $time_{IP}^{InOut}=0$ and would move from the IP outsidei similarly as the bottom muon. This is not case for top muon, which travels from outside towards the IP, and therefore the timing information of the top muon is disregarded and only the time of the bottom muon is associated with the track reconstructed in the tracker. 

As also displayed in the right part of Fig.~\ref{fig:figures/muonTracks}, there are two kind of hits left in the tracker by cosmics. Ones in top part of the tracker in green, referred as ``top hits'' and others in blue in the bottom part, referred as ``bottom hits''. The timing of tracker, i.e. the sampling of a pulse shape in cosmics is the same as in collisions and is tuned for collisions. Therefore to obtain same cross talk as in collisions, the cosmic muon has to arrive to a given module at the same time as muon from collision would arrive to this module. The situation is simple for bottom hits, for which in case of the collision and cosmic muon being at the IP at the same time, the arrival time to the given module has to be the same. In case of top hits, the collision muon goes from outside towards the given module and then to IP, while for the collision muon the direction is opposite, it starts at IP and then passes through a given module and continues towards outside of the CMS. Therefore in this case both cosmic and collision muon with the same time at IP, reach the given module in top part of tracker at difefrent time, specifically the cosmic muon arrives there before the collision one. For this reason of timing mismatch in the top part of the tracker, only hits in the bottom part of the tracker are used.

    \insertFigure{figures/muonTracks} % Filename = label
                 {0.99}       % Width, in fraction of the whole page width
                 { A schema of possible configurations of muon legs and hits in the tracker. }


The distribution of time and free inverse beta for the bottom legs of the muons are shown in Fig.~\ref{fig:figures/mutimebeta}. As expected, the free inverse beta has  a largest population around one, as the direction of the bottom legs is from the IP outwards and that the muon speed is close to the speed-of-light. For the further analysis only muon tracks with positive free inverse beta are used. In principle, the time distribution for cosmic muon should be uniform due to the random arrival time of cosmics to the interaction point. But as mentioned in~\cite{Chatrchyan:2009ig}, the trigger efficiency is highest for muons arriving to the interaction point in time window of $\pm 5$~ns around the collision time. Time distribution in Fig.~\ref{fig:figures/mutimebeta} peaks around -3.5~ns similarly as observed in the note on muon timing~\cite{Traczyk:1365029}. The muons with time equal to zero, passed the interaction point at the same time when the collision muon would be produced at IP. The resolution, computed as FWHM, of the time distribution is 15.7~ns. To evaluate which part of the resolution is caused by resolution of time measurement in DTs, the timing distribution from DTs of muons produced in collision with a Gaussian fit is shown in Fig~\ref{fig:figures/timeColl}. The collision muons are produced at time equal to zero, therefore there is no ambiguity on production time as for the cosmic muons. But still the muon time is computed with an assumption that muon travels at the speed-of-light. The resolution of collision muon time computed from the fit is 3.9~ns. The cosmic muon timing distribution is more than four times larger because of the natural spread in arrival time of cosmics. Another bias in time measurement can appear due to the assumption wich is used in time computation, that the muon passes through the interaction point.
 

    \insertTwoFigures{figures/mutimebeta} % Filename = label
                 {figures/timeBot}
                 {figures/freeInverseBetaBot} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 {(left) Time distribution of bottom muon legs in 2018 CRUZET VR data. (right) The free inverse beta distribution of bottom muon legs in 2018 CRUZET VR data.}


    \insertFigure{figures/timeColl} % Filename = label
                 {0.5}       % Width, in fraction of the whole page width
                 { Time distribution with Gaussian fit of 2017 era~F muons originating from collisions.  }


The timing of pulse shape sampling in tracker is tuned in a way that the cluster seed charge is required to be maximal. Such timing adjustments are done with particles originating from collision, thus their production time is fixed to zero. Therefore to evaluate, if the cosmic muon time is in alignment with the collision one, the cluster seed charge distribution as a function of muon timei for the OB2 geometry shown in the left plot of Fig.~\ref{fig:figures/chargeVsTime} can be studied. This distribution is fitted with Gaussian function giving a mean $\mu = -6.6 \pm 0.3$, which is not compatible with zero within its uncertainty. As mentioned, there is a bias in the time measurement leading from the fact, that cosmic muons do not have to pass through the interaction point, but the muon time computation is extrapolating muon time to the interaction point. This effect could shift the maximum of seed charge from time equal to zero. To evaluate what is the dependency of maximum of the cluster seed charge as a function of the closest distance of track from the IP, the right plot of Fig.~\ref{fig:figures/chargeVsTime} is again revealing the mean of cluster charge as a function of time, but this time for three different cases of tracks passing at different closest distances to the IP. The closest distance, further referred only as ``distance'', of the track from the IP  is determined as a shortest distance between any point on the track and the IP. On the plot it can be noticed, that the maxima of the cluster seed charge for the three cases are at different positions. Morover smaller the distance, the cluster seed chareg peaks at smaller time. Because of observed ambiguity, the muon time has to be corrected as a function of distance. The time correction factor can be obtained from a linear fit of the time positions~($t_{max}$) of the maxima of Gaussian fits displayed in the right plot of Fig.~\ref{fig:figures/chargeVsTime} as a function of distance~($dist$). The fit is giving dependecy between time and distance

\eq{driftEquation}
{
t_{max} = 0.07 dist  - 10.3,
}

leading to a conclusion that the cluster seed charge is maximal for muon which passes directly through the interaction point at time equal to $-10.3 \pm 0.9 $. The dependency of time on track distance can be resolved by subtracting the factor $ 0.07 dist $ from the muon time.

%at the maximum is largest for the closest tracks to the IP. But the maxima are at the same positions, therefore the distance of the track from IP is not causing any major shift of the charge distribution in time, but it acts more as a resolution effect. 


    \insertTwoFigures{figures/chargeVsTime} % Filename = label
                 {figures/chargePerUnitTOB2bottommuBottom}
                 {figures/chargePerUnitBinsTOB2bottommuBottom} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 {(left) The cluster seed charge profile as a function of time for the OB2 geometry in 2018 VR CRUZET data. The measured data were fitted by a Gaussian function. (right) The cluster seed charge profiles as a function of time for the OB2 geometry and for three different distances of the muon track from the IP in 2018 VR data with the Gaussian fits. }

As suggested above, the cross talk depends on time and therefore to obtain the cross talk transferable to collision conditions, in the time window when the cluster seed charge is maximal. To prove the hypothesis of cross talk dependence on time, the $\eta_{\pm 1}$ and $\eta_{\pm 2}$ distributions were filled with a cluster information from muons in 4~ns window, fitted by a Gaussian, which mean was used to evaluate the evolution of charge sharing as a function of time for OB2 geometry as shown in Fig.~\ref{fig:figures/etaAsTime}. Each bin of this figure corresponds to the middle of the 4~ns interval in which the fit was performed, i.e. the bin corresponding to time zero integrated over clusters from muon arriving to the IP at time window $-10 \pm 2$~ns. The $\eta_{\pm 1}$ and $\eta_{\pm 2}$ distributions resulting from muons within this time window, together with the Gaussian fit are shown in Fig.~\ref{fig:figures/xtalkTOB2}. The figures reveal a Gaussian distribution of certain width due to the strip noise. The tails are caused by charge sharing due to incination of track or diffusion. In Fig.~\ref{fig:figures/etaAsTime} it can be clearly seen that the charge sharing is smaller for muons arriving to a given module before a collision particle would and larger for muons passing a given module later than particle from the collision would. Given this observation it is necessary to impose the selection on the muon arrival time for which the vluster seed charge is maximal. The time window was selected to be $-10 \pm 2$~ns with regard to the time resolution from the DTs.

%TODO start here

    \insertTwoFigures{figures/etaAsTime} % Filename = label
                 {figures/etaOneaAsTimeTOB2bottommuBottom}
                 {figures/etaTwoAsTimeTOB2bottommuBottom} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 { The time evolution of the charge shared to the first (left) and second (right) neighboring strip divided by the seed charge for OB2 geometry in 2018 CRUZET VR data.}

    \insertTwoFigures{figures/xtalkTOB2} % Filename = label
                 {figures/narrowTrackSharing1TOB2bottommuBottom}
                 {figures/narrowTrackSharing2TOB2bottommuBottom} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 { The $\eta_{\pm 1}$ (left) and  $\eta_{\pm 2}$ (right) distribution of muon tracks in the time window of $-10 \pm 2$~ns for the OB2 geometry in 2018 VR CRUZET data and its Gaussian fit.}


%After rejecting the muon tracks outside of the $-10 \pm 2$~ns time window, the evolution of the $\eta_{\pm 1}$ and $\eta_{\pm 2}$ as a function of distance from the IP is shown in Fig.~\ref{fig:figures/etaAsDist}. The distributions were filled similarly as ones in Fig.~\ref{fig:figures/etaAsTime}, but this time the sharing was not measured in time window of 4~ns, but the distance window of 4~cm. The x-axis in these plots corresponds to the lower edge of the distance window. Both $\eta_{\pm 1}$ and $\eta_{\pm 2}$ are changing and fluctuating quickly as a function of distance and do not exhibit any clear trend.

%    \insertTwoFigures{figures/etaAsDist} % Filename = label
%                 {figures/etaOneaAsDistTOB2bottommuBottom}
%                 {figures/etaTwoAsDistTOB2bottommuBottom} % Filename = label
%                 {0.45}       % Width, in fraction of the whole page width
%                 {(left) The evolution of the charge shared to the first neighboring strip divided by the seed charge as a function of the track distance from the IP for OB2 geometry in 2018 CRUZET VR data.  (right) The evolution of the charge shared to the second neighboring strip divided by the seed charge as a function of the track distance from the IP for OB2 geometry in 2018 CRUZET VR data. }

The cross talk parameters are computed from Eq.~\ref{eq:fractions} for all barrel geometries in the time window of $0-10 \pm 2$~ns from the Gaussian fit of corresponding  $\eta_{\pm 1}$ and $\eta_{\pm 2}$ distributions as shown for OB2 in Fig.~\ref{fig:figures/xtalkTOB2}. The measured values together with the values currently used in the simulation are recorded in Tab.~\ref{tab:measuredXtalk}.


\begin{table}[h]
\begin{center}
\begin{tabular}{|l|l|l|l|l|}
\hline
Geometry & Type & $x_{0}$ & $x_{1}$ & $x_{2}$ \\
\hline
\hline
IB1 & current measurement & $ 0.848 \pm 0.017 $ & $0.063 \pm 0.008 $ & $0.013 \pm 0.003 $ \\
IB1 & currently in simulation & $ 0.775 $ & $ 0.096 $ & $0.017 $  \\
\hline
IB2 &  current measurement & $0.878 \pm 0.021 $ & $0.053 \pm 0.006 $ & $0.008 \pm $ 0.003   \\
IB2 & currently in simulation &  $0.830 $ & $0.076 $ & $ 0.009$   \\
\hline
OB2 &  current measurement & $0.808 \pm 0.020 $ & $0.079 \pm 0.006 $ & $0.017 \pm 0.004$  \\
OB2 & currently in simulation &   $0.725 $ & $0.110 $ & $ 0.027 $  \\
\hline
OB1 &  current measurement &  $0.769 \pm 0.021 $ & $0.093 \pm 0.006 $ & $0.023 \pm 0.004 $  \\
OB1 & currently in simulation &  $0.687 $ & $0.122 $ & $ 0.034 $ \\
\hline
\end{tabular}
\caption[Table caption text]{The cross talk measured in 2018 CRUZET VR data and the cross talk values used currently in simulation for barrel geometries. }
\label{tab:measuredXtalk}
\end{center}
\end{table}

In the Tab.~\ref{tab:measuredXtalk} it can be noticed, that in all cases the sharing of the charge decreased. During the previous cross talk measurement, no timing information was taken into account and therefore part of the change can originate from including the time information to evaluate the cross talk. But there is also real change of cross talk due to the radiation effects. The radiation is different for each layer and as the cross talk changes with the radiation damage of the module, each layer within one geometry should have different cross talk. To prove this the $\eta_{\pm 1}$ and $\eta_{\pm 2}$ dependency on time is shown in Fig.~\ref{fig:figures/etaAsLayers} for four layers of OB2 separately. The plots were obtained similarly as plots in Fig.~\ref{fig:figures/etaAsTime}, but this time the time window for each bin is 6~ns in order to gain in statistics. In the $\eta_{\pm 1}$ and $\eta_{\pm 2}$ distributions can be seen, that in  case of $\eta_{\pm 1}$ the sharing is larger for the first two layers, than of layer three and four. There is also visible difference in charge sharing between layer three and four. 

The first two layers are composed of double-sided modules, while the second two have only one side of sensors. In the double-sided modules, the sensors are back to back, therefore a particle going from the IP outside the CMS is entering one sensor from the side of strips and the second from the backplane. As there is also a cross talk which is caused by the movement of the charge carriers, this cross talk could be different depending on from which side the particle enters the sensor and therefore there can be a different cross talk between mono and stereo side of one layer [TODO needs to be discussed]. The $\eta_{\pm 1}$ and $\eta_{\pm 2}$ as a function of time, for decomposed mono and stereo modules of OB2 layer one and two is shown in Fig.~\ref{fig:figures/etaAsMonoStereo}. In these plots, in majority of bins of $\eta_{\pm 1}$ and $\eta_{\pm 1}$  distribution, the sharing within one layer is larger for stereo sensors than mono. This would explain that the first two layers of OB2, which are composed of double-sided modules, exhibit larger charge sharing to the first neighboring strip than the second two, which are single-sided, as discussed in Fig.~\ref{fig:figures/etaAsLayers}. The evidence for pure dependency of cross talk on the radiation can then be observed by the change of $\eta_{\pm 1}$ between layer three and four in the same plot.


    \insertTwoFigures{figures/etaAsLayers} % Filename = label
                 {figures/etaOneaAsTimeLayerTOB2bottommuBottom}
                 {figures/etaTwoAsTimeLayerTOB2bottommuBottom} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 { The time evolution of the charge shared to the first (left) and second (right) neighboring strip divided by the seed charge for four layers of OB2 geometry in 2018 CRUZET VR data.}


    \insertTwoFigures{figures/etaAsMonoStereo} % Filename = label
                 {figures/etaOneaAsTimeMonoStereoTOB2bottommuBottom}
                 {figures/etaTwoAsTimeMonoStereoTOB2bottommuBottom} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 { The time evolution of the charge shared to the first (left) and second (right) neighboring strip divided by the seed charge for mono and stereo sensors of first two layers of TOB in 2018 CRUZET VR data.}



To evaluate if the new cross talk measurement contributes to an improvement in the data and simulation comparison, it was injected into simulation and compared with data and default simulation. The cluster charge, width and seed charge distributions for barrel geometries are shown in Fig.\ref{fig:figures/clusterchargeRescaledTIBXTm}~and~\ref{fig:figures/seedTOBXTm}. In these plots it is obvious, that newly measured cross talk parameters largely improved overall cluster width and seed charge description. For OB2, the measured cross talk fractions $(x_{0}, x_{1}, x_{2})$ are ($0.81 \pm 0.02 , 0.079 \pm 0.006, 0.017 \pm 0.004$). When tuning the cross talk parameters in Sec.~\ref{sec:induce} to best describe the cluster width in data, the obtained fractions are (0.814,0.070,0.023), which are compatible with the measurement. Even though the large improvemnt, there are still discrepancies in description of data by simulation. These disrecpancies could be caused by the oudated conditions, such as gains and noise, but also it can be caused by the fact that the simulation is simplified and many parts of the simulation are outdated. Thus the cross talk in simulation does not have to purely describe cross talk, but it can compensate for other effects as well. 


% Therefore larger charge sharing is observed in data, than it would be needed in simulation. This could be caused by the fact, that the simulation is simplified and many parts of the simulation are outdated. Thus the cross talk in simulation does not have to purely describe cross talk, but it can compensate for other effects. 

    \insertTwoFigures{figures/clusterchargeRescaledTIBXTm} % Filename = label
                 {figures/clusterchargeRescaledTIBl1to2XTm} % Filename = label
                 {figures/clusterchargeRescaledTIBl3to4XTm} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 { Distribution of the on-track cluster charge in data and simulation for IB1 (left) and IB2 (right) geometry and for current and newly measured cross talk parameters~($XT$).  The simulated distributions are rescaled to the number of clusters in data.  Bottom plots represent data to simulation ratios. }

    \insertTwoFigures{figures/widthTIBXTm} % Filename = label %TDO continue here
                 {figures/clusterwidthTIBl1to2XTm}
                 {figures/clusterwidthTIBl3to4XTm}
                 {0.45}       % Width, in fraction of the whole page width
                 { Distribution of the on-track cluster width in data and simulation for IB1 (left) and IB2 (right) geometry and for current and newly measured cross talk parameters~($XT$).  The simulated distributions are rescaled to the number of clusters in data.  Bottom plots represent data to simulation ratios. }

    \insertTwoFigures{figures/seedTIBXTm} % Filename = label
                 {figures/clusterseedchargeRescaledTIBl1to2XTm} % Filename = label
                 {figures/clusterseedchargeRescaledTIBl3to4XTm} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 { Distribution of the on-track cluster seed charge in data and simulation for IB1 (left) and IB2 (right) geometry and for current and newly measured cross talk parameters~($XT$).  The simulated distributions are rescaled to the number of clusters in data.  Bottom plots represent data to simulation ratios. }


    \insertTwoFigures{figures/clusterchargeRescaledTOBXTm} % Filename = label
                 {figures/clusterchargeRescaledTOBl1to4XTm} % Filename = label
                 {figures/clusterchargeRescaledTOBl5to6XTm} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 { Distribution of the on-track cluster charge in data and simulation for OB2 (left) and OB1 (right) geometry and for current and newly measured cross talk parameters~($XT$).  The simulated distributions are rescaled to the number of clusters in data.  Bottom plots represent data to simulation ratios. }

    \insertTwoFigures{figures/widthTOBXTm} % Filename = label %TDO continue here
                 {figures/clusterwidthTOBl1to4XTm}
                 {figures/clusterwidthTOBl5to6XTm}
                 {0.45}       % Width, in fraction of the whole page width
                 { Distribution of the on-track cluster width in data and simulation for OB2 (left) and OB1 (right) geometry and for current and newly measured cross talk parameters~($XT$).  The simulated distributions are rescaled to the number of clusters in data.  Bottom plots represent data to simulation ratios. }

    \insertTwoFigures{figures/seedTOBXTm} % Filename = label
                 {figures/clusterseedchargeRescaledTOBl1to4XTm} % Filename = label
                 {figures/clusterseedchargeRescaledTOBl5to6XTm} % Filename = label
                 {0.45}       % Width, in fraction of the whole page width
                 { Distribution of the on-track cluster seed charge in data and simulation for OB2 (left) and OB1 (right) geometry and for current and newly measured cross talk parameters~($XT$).  The simulated distributions are rescaled to the number of clusters in data.  Bottom plots represent data to simulation ratios. }

\textbf{Conclusion}

In this section the results on the cross talk measurement were shown. The cross talk parameters used in simulation were measured at the beginning of Run~I, and as demonstrated in this section, the cross talk changes with aging of the detector and therefore it had to be remeasured. It was also shown that the cross talk depends on the particle arrival time to the module, which was not taken into account during the Run~I measurements. The newly measured cross talk improved the description of cluster properties of data by simulation althoug minor discrepanices can be still observed. These non-descriptions can be caused by the outdated database conditions and therefore they are being updated for the 2018 simualted samples. If after the update of database conditions there are discrepancies between data and simulation in the cluster charge, it a sign that the conversion factor between energy and electrons or electons and ADC has to be updated as well. These conversion factors have only minor influence on the cluster width. The cross-talk was found to be only parameter in the simulation which strongly influences the cluster width, therefore if the update of database conditions leads to large discrepancies in cluster width, it means that the simulation is over-simplified and update of cross-talk is not sufficient to well described the cluster propertiesin data. In such case the cross talk can be tuned to best described data as described in section~\ref{sec:induce}. In this case the cross talk parameter would not purelya ccount for the cross talk effect but would compansate for other effects not described in the simulation.

Due to the limitations of data used to measure cross talk, it is not possible to evaluate cross talk in the disks and endcapes. To update cross talk also for disk and endcapes, dedicated data-taking would be required. Another option is again to deetrmine cross-talk parameters from the data and simulation comparison as described in section~\ref{sec:induce}. If the second approach is chosen, it is necesary first to update detector conditions, which are bad channels, noise and gains. These conditions are obtained from data and can affect the cluster width and charge. Then the matrix of the simulations with different cross talk parameters would be produced and these simulations would be compared to data. The agreement between data and simulations would be established based on a $\chi^{2}$ test of the cluster width distribution compatibility. The cross talk parameters of the sample with the best $\chi^{2}$ can then be injected into simulation. 

%, leading to a conclusion, that the cross talk needed in simulation is compensating for other non-descriptions. To achieve a good data and simulation agreement, we have decided to plug into simulation the parameters  which describe the data the best, as presented in Sec.~\ref{sec:induce}. Also the cross talk could not be measured for disk and endcaps due to the geometrical restrictions of muons, but the approach of Sec.~\ref{sec:induce} can give results on all partitions.

%The chosen approach is to first update detector conditions, which are bad channels, noise and gains. These conditions are obtained from data and can affect the cluster width and charge. Then the matrix of the simulations with different cross talk parameters is produced and these simulations are compared to data. The agreement between data and simulations is established based on $\chi^{2}$ test of cluster width distribution compatibility. The cross talk parameters of sample with the best $\chi^{2}$ can then be injected into simulation. The cross talk parameters influence largely the cluster width and seed charge, but much less the cluster charge. If after tuning there is need for better description of cluster charge or seed charge, one of the conversion factors, either energy per electron or electron per ADC can be tuned similarly. These conversion factors are influencing the cluster width only slightly.


%TODO plug the measured cross talkinto the simulation
%TODO should I say sth more about other hits and tracks we do not use?
%In ideal case it would be best to acquire 0T collision VR data, which is not CMS priority. 

%actually the calue of cross talk we inject into MC can compensate for other effects and therefore does not have to agree with simualtions.
%\subsubsection{Cross talk tuning}

%[TODO This will come after the conditions are updated...]

  %the fit of charge distribution
  %NO.   NAME      VALUE            ERROR          SIZE      DERIVATIVE 
  % 1  Constant     3.39435e+03   7.97716e+00   4.20941e-03   2.42023e-05
  % 2  Mean        -1.82332e+00   1.70530e-01  -1.23780e-04   1.02297e-03
  % 3  Sigma        2.05388e+01   7.24243e-01   6.33711e-06   3.88536e-03

%dist<20
%TIB1
%x0 0.725506 +- 0.00815634
%x1 0.100057 +- 0.00297439
%x2 0.0371896 +- 0.00279007

%TIB2
%x0 0.795078 +- 0.0104821
%x1 0.0845729 +- 0.00427595
%x2 0.0178882 +- 0.00303061

%TOB2
%x0 0.704474 +- 0.00391049
%x1 0.112763 +- 0.00156127
%x2 0.0349995 +- 0.00117704

%TOB1
%x0 0.725506 +- 0.00815634
%x1 0.100057 +- 0.00297439
%x2 0.0371896 +- 0.00279007
